
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; Final project id# - 50604215</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/final_project_code';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Final project id# - 50604215 - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="Final project id# - 50604215 - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to My Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../markdown/Mahiswar_Reddy_D_resume.html">Mahiswar Reddy D Resume</a></li>
<li class="toctree-l1"><a class="reference internal" href="final_project.html">CODE for final project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../markdown/Links_of_work.html">Additional Resources</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/final_project_code.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/final_project_code.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><no title></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="simple visible nav section-nav flex-column">
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="c1"># Define file paths</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;output_data.csv&#39;</span>
<span class="n">new_db_path</span> <span class="o">=</span> <span class="s1">&#39;normalized_data.db&#39;</span>

<span class="c1"># Create a new SQLite database connection</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">new_db_path</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Create tables for normalization</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS MainTable (</span>
<span class="s2">    ID INTEGER PRIMARY KEY,</span>
<span class="s2">    Age INTEGER,</span>
<span class="s2">    AnnualIncome INTEGER,</span>
<span class="s2">    FamilyMembers INTEGER,</span>
<span class="s2">    ChronicDiseases INTEGER,</span>
<span class="s2">    TravelInsurance INTEGER,</span>
<span class="s2">    EmploymentTypeID INTEGER,</span>
<span class="s2">    GraduateStatusID INTEGER,</span>
<span class="s2">    FrequentFlyerID INTEGER,</span>
<span class="s2">    TravelAbroadID INTEGER,</span>
<span class="s2">    FOREIGN KEY (EmploymentTypeID) REFERENCES EmploymentType(ID),</span>
<span class="s2">    FOREIGN KEY (GraduateStatusID) REFERENCES GraduateStatus(ID),</span>
<span class="s2">    FOREIGN KEY (FrequentFlyerID) REFERENCES FrequentFlyer(ID),</span>
<span class="s2">    FOREIGN KEY (TravelAbroadID) REFERENCES TravelAbroad(ID)</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS EmploymentType (</span>
<span class="s2">    ID INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    Type TEXT UNIQUE</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS GraduateStatus (</span>
<span class="s2">    ID INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    Status TEXT UNIQUE</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS FrequentFlyer (</span>
<span class="s2">    ID INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    Status TEXT UNIQUE</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS TravelAbroad (</span>
<span class="s2">    ID INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    Status TEXT UNIQUE</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Commit schema creation</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># Read data from the CSV file</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="c1"># Extract unique values for categorical columns</span>
<span class="n">employment_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Employment Type&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>
<span class="n">graduate_status</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;GraduateOrNot&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>
<span class="n">frequent_flyer_status</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;FrequentFlyer&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>
<span class="n">travel_abroad_status</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;EverTravelledAbroad&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>

<span class="c1"># Populate categorical tables</span>
<span class="k">for</span> <span class="n">employment</span> <span class="ow">in</span> <span class="n">employment_types</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT OR IGNORE INTO EmploymentType (Type) VALUES (?);&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">employment</span><span class="p">,))</span>

<span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">graduate_status</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT OR IGNORE INTO GraduateStatus (Status) VALUES (?);&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">status</span><span class="p">,))</span>

<span class="k">for</span> <span class="n">flyer_status</span> <span class="ow">in</span> <span class="n">frequent_flyer_status</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT OR IGNORE INTO FrequentFlyer (Status) VALUES (?);&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">flyer_status</span><span class="p">,))</span>

<span class="k">for</span> <span class="n">abroad_status</span> <span class="ow">in</span> <span class="n">travel_abroad_status</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT OR IGNORE INTO TravelAbroad (Status) VALUES (?);&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">abroad_status</span><span class="p">,))</span>

<span class="c1"># Commit inserts into categorical tables</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># Map categorical values to IDs</span>
<span class="n">employment_type_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT ID, Type FROM EmploymentType;&quot;</span><span class="p">)}</span>
<span class="n">graduate_status_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT ID, Status FROM GraduateStatus;&quot;</span><span class="p">)}</span>
<span class="n">frequent_flyer_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT ID, Status FROM FrequentFlyer;&quot;</span><span class="p">)}</span>
<span class="n">travel_abroad_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT ID, Status FROM TravelAbroad;&quot;</span><span class="p">)}</span>

<span class="c1"># Prepare and insert data into the main table</span>
<span class="n">main_table_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]),</span>  <span class="c1"># ID</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]),</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;AnnualIncome&#39;</span><span class="p">]),</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;FamilyMembers&#39;</span><span class="p">]),</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;ChronicDiseases&#39;</span><span class="p">]),</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;TravelInsurance&#39;</span><span class="p">]),</span>
        <span class="n">employment_type_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Employment Type&#39;</span><span class="p">]],</span>
        <span class="n">graduate_status_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;GraduateOrNot&#39;</span><span class="p">]],</span>
        <span class="n">frequent_flyer_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;FrequentFlyer&#39;</span><span class="p">]],</span>
        <span class="n">travel_abroad_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;EverTravelledAbroad&#39;</span><span class="p">]]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span>
<span class="p">]</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">INSERT INTO MainTable (</span>
<span class="s2">    ID, Age, AnnualIncome, FamilyMembers, ChronicDiseases, TravelInsurance,</span>
<span class="s2">    EmploymentTypeID, GraduateStatusID, FrequentFlyerID, TravelAbroadID</span>
<span class="s2">) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">main_table_data</span><span class="p">)</span>

<span class="c1"># Commit changes and close the connection</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IntegrityError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">115</span>
<span class="g g-Whitespace">     </span><span class="mi">98</span> <span class="c1"># Prepare and insert data into the main table</span>
<span class="g g-Whitespace">     </span><span class="mi">99</span> <span class="n">main_table_data</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span>     <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span>         <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]),</span>  <span class="c1"># ID</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span>     <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span>
<span class="g g-Whitespace">    </span><span class="mi">113</span> <span class="p">]</span>
<span class="ne">--&gt; </span><span class="mi">115</span> <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">116</span><span class="s2"> INSERT INTO MainTable (</span>
<span class="g g-Whitespace">    </span><span class="mi">117</span><span class="s2">     ID, Age, AnnualIncome, FamilyMembers, ChronicDiseases, TravelInsurance,</span>
<span class="g g-Whitespace">    </span><span class="mi">118</span><span class="s2">     EmploymentTypeID, GraduateStatusID, FrequentFlyerID, TravelAbroadID</span>
<span class="g g-Whitespace">    </span><span class="mi">119</span><span class="s2"> ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?);</span>
<span class="g g-Whitespace">    </span><span class="mi">120</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">main_table_data</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span> <span class="c1"># Commit changes and close the connection</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="ne">IntegrityError</span>: UNIQUE constraint failed: MainTable.ID
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="c1"># Define the database file path</span>
<span class="n">db_path</span> <span class="o">=</span> <span class="s1">&#39;normalized_data.db&#39;</span>

<span class="c1"># Function to execute a query and print the results</span>
<span class="k">def</span> <span class="nf">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Connect to the database</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="c1"># Execute the query</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Fetch all results</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="c1"># Get column names</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">description</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>

        <span class="c1"># Print the results</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">row</span><span class="p">)))</span>

        <span class="c1"># Close the connection</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Sample queries</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Fetch all records from the MainTable:&quot;</span><span class="p">)</span>
<span class="n">query_main_table</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM MainTable;&quot;</span>
<span class="n">table_info</span><span class="o">=</span><span class="s2">&quot;pragma table_info(MainTable);&quot;</span>
<span class="n">execute_query</span><span class="p">(</span><span class="n">table_info</span><span class="p">)</span>

<span class="c1">#print(&quot;\n2. Fetch employment types:&quot;)</span>
<span class="c1">#query_employment_type = &quot;SELECT * FROM EmploymentType;&quot;</span>
<span class="c1">#execute_query(query_employment_type)</span>

<span class="c1">#print(&quot;\n3. Fetch graduate statuses:&quot;)</span>
<span class="c1">#query_graduate_status = &quot;SELECT * FROM GraduateStatus;&quot;</span>
<span class="c1">#execute_query(query_graduate_status)</span>

<span class="c1"># You can add more queries as needed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1. Fetch all records from the MainTable:
cid | name | type | notnull | dflt_value | pk
--------------------------------------------------------------------------------
0 | ID | INTEGER | 0 | None | 1
1 | Age | INTEGER | 0 | None | 0
2 | AnnualIncome | INTEGER | 0 | None | 0
3 | FamilyMembers | INTEGER | 0 | None | 0
4 | ChronicDiseases | INTEGER | 0 | None | 0
5 | TravelInsurance | INTEGER | 0 | None | 0
6 | EmploymentTypeID | INTEGER | 0 | None | 0
7 | GraduateStatusID | INTEGER | 0 | None | 0
8 | FrequentFlyerID | INTEGER | 0 | None | 0
9 | TravelAbroadID | INTEGER | 0 | None | 0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Connect to the normalized database</span>
<span class="n">db_path</span> <span class="o">=</span> <span class="s1">&#39;normalized_data.db&#39;</span>  <span class="c1"># Path to your database file</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>

<span class="c1"># List all tables in the database to confirm the structure</span>
<span class="n">query_tables</span> <span class="o">=</span> <span class="s2">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;&quot;</span>
<span class="n">tables</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query_tables</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tables in the database:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>

<span class="c1"># Reconstruct data using SQL joins</span>
<span class="n">query_reconstruct</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT </span>
<span class="s2">    MainTable.ID, </span>
<span class="s2">    MainTable.Age, </span>
<span class="s2">    MainTable.AnnualIncome, </span>
<span class="s2">    MainTable.FamilyMembers, </span>
<span class="s2">    MainTable.ChronicDiseases, </span>
<span class="s2">    MainTable.TravelInsurance,</span>
<span class="s2">    EmploymentType.Type AS EmploymentType,</span>
<span class="s2">    GraduateStatus.Status AS GraduateStatus,</span>
<span class="s2">    FrequentFlyer.Status AS FrequentFlyerStatus,</span>
<span class="s2">    TravelAbroad.Status AS TravelAbroadStatus</span>
<span class="s2">FROM MainTable</span>
<span class="s2">LEFT JOIN EmploymentType ON MainTable.EmploymentTypeID = EmploymentType.ID</span>
<span class="s2">LEFT JOIN GraduateStatus ON MainTable.GraduateStatusID = GraduateStatus.ID</span>
<span class="s2">LEFT JOIN FrequentFlyer ON MainTable.FrequentFlyerID = FrequentFlyer.ID</span>
<span class="s2">LEFT JOIN TravelAbroad ON MainTable.TravelAbroadID = TravelAbroad.ID;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Load the reconstructed data into a Pandas DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query_reconstruct</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>

<span class="c1"># Close the connection</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Display the first few rows of the data</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reconstructed Data:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tables in the database:
              name
0        MainTable
1   EmploymentType
2  sqlite_sequence
3   GraduateStatus
4    FrequentFlyer
5     TravelAbroad
Reconstructed Data:
   ID  Age  AnnualIncome  FamilyMembers  ChronicDiseases  TravelInsurance  \
0   0   31        400000              6                1                0   
1   1   31       1250000              7                0                0   
2   2   34        500000              4                1                1   
3   3   28        700000              3                1                0   
4   4   28        700000              8                1                0   

                 EmploymentType GraduateStatus FrequentFlyerStatus  \
0             Government Sector            Yes                  No   
1  Private Sector/Self Employed            Yes                  No   
2  Private Sector/Self Employed            Yes                  No   
3  Private Sector/Self Employed            Yes                  No   
4  Private Sector/Self Employed            Yes                 Yes   

  TravelAbroadStatus  
0                 No  
1                 No  
2                 No  
3                 No  
4                 No  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Step 1: Set the tracking URI</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Set your DagsHub access token in the headers</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mahiswarreddydesireddy18&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;502864c8473782218c50bbdd48801403d265ada8&quot;</span>

<span class="c1"># Step 3: Create or set the experiment</span>
<span class="n">experiment_name</span> <span class="o">=</span> <span class="s2">&quot;Model Optimization and Comparison&quot;</span>

<span class="c1"># Check if the experiment exists, otherwise create it</span>
<span class="n">experiment</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">get_experiment_by_name</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span>
<span class="k">if</span> <span class="n">experiment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">create_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span>

<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span>

<span class="c1"># Step 4: Log a test experiment to verify connectivity</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Test_Run&quot;</span><span class="p">):</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;param1&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;metric1&quot;</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">set_tag</span><span class="p">(</span><span class="s2">&quot;tag1&quot;</span><span class="p">,</span> <span class="s2">&quot;test_tag&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MLflow tracking URI: </span><span class="si">{</span><span class="n">mlflow</span><span class="o">.</span><span class="n">get_tracking_uri</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Experiment &#39;</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">&#39; is ready for logging.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Test_Run at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/8c5ccd6234d1434da7e1fa76a68acff0
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
MLflow tracking URI: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow
Experiment &#39;Model Optimization and Comparison&#39; is ready for logging.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Data Cleaning and Preprocessing&quot;</span><span class="p">):</span>

    <span class="c1"># Copy the data for cleaning and preprocessing</span>
    <span class="n">cleaned_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Step 1: Inspect Missing Values</span>
    <span class="n">missing_values</span> <span class="o">=</span> <span class="n">cleaned_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Missing Values:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">missing_values</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Missing_Values&quot;</span><span class="p">,</span> <span class="n">missing_values</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

    <span class="c1"># Step 2: Handle Missing Values</span>
    <span class="c1"># (Here, I’ll drop rows with missing values for simplicity. Adjust if needed.)</span>
    <span class="n">cleaned_df</span> <span class="o">=</span> <span class="n">cleaned_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="c1"># Log a snapshot of the cleaned data as an artifact</span>
    <span class="n">cleaned_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;cleaned_data.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;cleaned_data.csv&quot;</span><span class="p">)</span>

    <span class="c1"># Step 3: Check for Outliers (Boxplot)</span>
    <span class="n">numeric_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;AnnualIncome&#39;</span><span class="p">,</span> <span class="s1">&#39;FamilyMembers&#39;</span><span class="p">,</span> <span class="s1">&#39;ChronicDiseases&#39;</span><span class="p">,</span> <span class="s1">&#39;TravelInsurance&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">cleaned_df</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Outliers Detection Using Boxplot&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;boxplot_outliers.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;boxplot_outliers.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Step 4: Rename Columns</span>
    <span class="n">renamed_columns</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;EmploymentType&#39;</span><span class="p">:</span> <span class="s1">&#39;Employment_Type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;GraduateStatus&#39;</span><span class="p">:</span> <span class="s1">&#39;Graduate_Status&#39;</span><span class="p">,</span>
        <span class="s1">&#39;FrequentFlyerStatus&#39;</span><span class="p">:</span> <span class="s1">&#39;Frequent_Flyer_Status&#39;</span><span class="p">,</span>
        <span class="s1">&#39;TravelAbroadStatus&#39;</span><span class="p">:</span> <span class="s1">&#39;Travel_Abroad_Status&#39;</span>
    <span class="p">}</span>
    <span class="n">cleaned_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">renamed_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Renamed_Columns&quot;</span><span class="p">,</span> <span class="n">renamed_columns</span><span class="p">)</span>

    <span class="c1"># Step 5: Verify Data Types</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data Types Before Correction:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cleaned_df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
    <span class="n">cleaned_df</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data_types.csv&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;data_types.csv&quot;</span><span class="p">)</span>

    <span class="c1"># Step 6: Summarize Data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Descriptive Statistics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cleaned_df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
    <span class="n">cleaned_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;descriptive_statistics.csv&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;descriptive_statistics.csv&quot;</span><span class="p">)</span>

    <span class="c1"># Step 7: Exploratory Data Analysis (EDA)</span>
    <span class="c1"># Visualize the distribution of Age</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">cleaned_df</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Age Distribution&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Age&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;age_distribution.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;age_distribution.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Pair Plot for Numerical Columns</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">cleaned_df</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Pairwise Relationships Among Numerical Columns&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;pairwise_relationships.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;pairwise_relationships.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;EDA and preprocessing steps logged to DagsHub!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Missing Values:
ID                     0
Age                    0
AnnualIncome           0
FamilyMembers          0
ChronicDiseases        0
TravelInsurance        0
EmploymentType         0
GraduateStatus         0
FrequentFlyerStatus    0
TravelAbroadStatus     0
dtype: int64
</pre></div>
</div>
<img alt="../_images/68132ab21aea82e759df9e07b963250fd91fea52b9c2b470aea6a2713a17663f.png" src="../_images/68132ab21aea82e759df9e07b963250fd91fea52b9c2b470aea6a2713a17663f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data Types Before Correction:
ID                        int64
Age                       int64
AnnualIncome              int64
FamilyMembers             int64
ChronicDiseases           int64
TravelInsurance           int64
Employment_Type          object
Graduate_Status          object
Frequent_Flyer_Status    object
Travel_Abroad_Status     object
dtype: object
Descriptive Statistics:
                ID          Age  AnnualIncome  FamilyMembers  ChronicDiseases  \
count  1987.000000  1987.000000  1.987000e+03    1987.000000      1987.000000   
mean    993.000000    29.650226  9.327630e+05       4.752894         0.277806   
std     573.741812     2.913308  3.768557e+05       1.609650         0.448030   
min       0.000000    25.000000  3.000000e+05       2.000000         0.000000   
25%     496.500000    28.000000  6.000000e+05       4.000000         0.000000   
50%     993.000000    29.000000  9.000000e+05       5.000000         0.000000   
75%    1489.500000    32.000000  1.250000e+06       6.000000         1.000000   
max    1986.000000    35.000000  1.800000e+06       9.000000         1.000000   

       TravelInsurance  
count      1987.000000  
mean          0.357323  
std           0.479332  
min           0.000000  
25%           0.000000  
50%           0.000000  
75%           1.000000  
max           1.000000  
</pre></div>
</div>
<img alt="../_images/171b60006e7fde35401cb35da14644514c1b7917f1054272c6e672ae3481d997.png" src="../_images/171b60006e7fde35401cb35da14644514c1b7917f1054272c6e672ae3481d997.png" />
<img alt="../_images/7ec99b51f9dfabf449860dea0e6fa8a4728db752a1921a27bf72e1d2b0761568.png" src="../_images/7ec99b51f9dfabf449860dea0e6fa8a4728db752a1921a27bf72e1d2b0761568.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run Data Cleaning and Preprocessing at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/0b141ed5ac724bb88fd96125ea7b3f3f
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
EDA and preprocessing steps logged to DagsHub!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Train-Test Split&quot;</span><span class="p">):</span>

    <span class="c1"># Check class distribution for the target variable</span>
    <span class="n">target_col</span> <span class="o">=</span> <span class="s1">&#39;TravelInsurance&#39;</span>
    <span class="n">class_distribution</span> <span class="o">=</span> <span class="n">cleaned_df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Class Distribution (TravelInsurance):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">class_distribution</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Class_Distribution&quot;</span><span class="p">,</span> <span class="n">class_distribution</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

    <span class="c1"># Visualize class distribution</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_distribution</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">class_distribution</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Class Distribution of Travel Insurance&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;TravelInsurance (0 = No, 1 = Yes)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Proportion&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;class_distribution.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;class_distribution.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Determine if stratification is necessary based on class distribution</span>
    <span class="n">stratify</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">class_distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">class_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Stratification_Applied&quot;</span><span class="p">,</span> <span class="n">stratify</span><span class="p">)</span>

    <span class="c1"># Perform train/test split with stratification if needed</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">cleaned_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_col</span><span class="p">,</span> <span class="s1">&#39;ID&#39;</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cleaned_df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>

    <span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span> <span class="k">if</span> <span class="n">stratify</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="c1"># Log the shapes of the training and testing datasets</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Train_Data_Shape&quot;</span><span class="p">,</span> <span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Test_Data_Shape&quot;</span><span class="p">,</span> <span class="n">test_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Train Data Shape: </span><span class="si">{</span><span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test Data Shape: </span><span class="si">{</span><span class="n">test_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stratification Applied: </span><span class="si">{</span><span class="n">stratify</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Class Distribution (TravelInsurance):
0    0.642677
1    0.357323
Name: TravelInsurance, dtype: float64
</pre></div>
</div>
<img alt="../_images/7a74b647eb785f6c9795cebcdbb8c189cfe577d15e31a7c57a4fc62b6e4984e9.png" src="../_images/7a74b647eb785f6c9795cebcdbb8c189cfe577d15e31a7c57a4fc62b6e4984e9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train Data Shape: (1390, 8)
Test Data Shape: (597, 8)
Stratification Applied: True
🏃 View run Train-Test Split at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/ead5b322f9644953b971b9c2f08e8170
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Correlation Matrix for Numerical Features</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Correlation Analysis&quot;</span><span class="p">):</span>
    <span class="c1"># Compute the correlation matrix</span>
    <span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
    
    <span class="c1"># Save the correlation matrix as a CSV for logging</span>
    <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;correlation_matrix.csv&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;correlation_matrix.csv&quot;</span><span class="p">)</span>

    <span class="c1"># Visualize the correlation matrix as a heatmap</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;correlation_matrix_heatmap.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;correlation_matrix_heatmap.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Log observations for highly correlated features</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Highly Correlated Features (Threshold = 0.7):&quot;</span><span class="p">)</span>
    <span class="n">high_corr_features</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">high_corr</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">correlation_matrix</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">high_corr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">high_corr_features</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">high_corr</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> highly correlates with: </span><span class="si">{</span><span class="n">high_corr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Highly_Correlated_Features&quot;</span><span class="p">,</span> <span class="n">high_corr_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/efc0c09f8fc1e20c6232975dc7839e496baf393a27fc37518e44976f1688124d.png" src="../_images/efc0c09f8fc1e20c6232975dc7839e496baf393a27fc37518e44976f1688124d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Highly Correlated Features (Threshold = 0.7):
🏃 View run Correlation Analysis at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/1e2f951f381c4d4fb19db946399b00c1
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Logistic Regression with Cross-Validation&quot;</span><span class="p">):</span>
    <span class="c1"># Define numerical and categorical columns</span>
    <span class="n">numerical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;AnnualIncome&#39;</span><span class="p">,</span> <span class="s1">&#39;FamilyMembers&#39;</span><span class="p">,</span> <span class="s1">&#39;ChronicDiseases&#39;</span><span class="p">]</span>
    <span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Employment_Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Graduate_Status&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequent_Flyer_Status&#39;</span><span class="p">,</span> <span class="s1">&#39;Travel_Abroad_Status&#39;</span><span class="p">]</span>

    <span class="c1"># Create the preprocessing pipeline</span>
    <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
        <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">numerical_features</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(),</span> <span class="n">categorical_features</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Create the full pipeline with Logistic Regression</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">])</span>

    <span class="c1"># Log pipeline details</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Classifier&quot;</span><span class="p">,</span> <span class="s2">&quot;LogisticRegression&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Max_Iter&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="c1"># Perform cross-validation (3-fold and 10-fold)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing 3-fold CV...&quot;</span><span class="p">)</span>
    <span class="n">cv_results_3</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing 10-fold CV...&quot;</span><span class="p">)</span>
    <span class="n">cv_results_10</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Log cross-validation results</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Mean_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Std_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Mean_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Std_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Mean_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Std_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Mean_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Std_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

    <span class="c1"># Save CV results as CSV artifacts</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cv_results_3</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;cv_results_3fold.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cv_results_10</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;cv_results_10fold.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;cv_results_3fold.csv&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;cv_results_10fold.csv&quot;</span><span class="p">)</span>

    <span class="c1"># Train on the full training data</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
    <span class="n">train_score</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>

    <span class="c1"># Log training accuracy</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Train_Accuracy&quot;</span><span class="p">,</span> <span class="n">train_score</span><span class="p">)</span>

    <span class="c1"># Store the results locally</span>
    <span class="n">experiment_1_results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;f1_mean_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;f1_std_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_mean_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_std_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;f1_mean_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;f1_std_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_mean_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_std_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;train_accuracy&quot;</span><span class="p">:</span> <span class="n">train_score</span>
    <span class="p">}</span>

    <span class="c1"># Display results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3-Fold CV Results:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">10-Fold CV Results:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training Accuracy: </span><span class="si">{</span><span class="n">train_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing 3-fold CV...
Performing 10-fold CV...
3-Fold CV Results:
F1-Score (Mean ± Std): 0.5966 ± 0.0242
Accuracy (Mean ± Std): 0.7655 ± 0.0086

10-Fold CV Results:
F1-Score (Mean ± Std): 0.6054 ± 0.0506
Accuracy (Mean ± Std): 0.7719 ± 0.0247

Training Accuracy: 0.7727
🏃 View run Logistic Regression with Cross-Validation at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/f69a296f2ad64fa88c7771f226aefae5
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Define classifiers to test</span>
<span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;LogisticRegression&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;RidgeClassifier&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
    <span class="s2">&quot;XGBClassifier&quot;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># Corrected</span>
<span class="p">}</span>

<span class="c1"># Dictionary to store results</span>
<span class="n">experiment_2_results</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Model Comparison&quot;</span><span class="p">):</span>
    <span class="c1"># Loop through classifiers</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Running </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Log classifier name</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">set_tag</span><span class="p">(</span><span class="s2">&quot;Classifier&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        
        <span class="c1"># Create the pipeline</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">classifier</span><span class="p">)</span>
        <span class="p">])</span>
        
        <span class="c1"># Perform 3-fold cross-validation</span>
        <span class="n">cv_results_3</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        
        <span class="c1"># Perform 10-fold cross-validation</span>
        <span class="n">cv_results_10</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
            <span class="n">pipeline</span><span class="p">,</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        
        <span class="c1"># Train on full training data</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
        <span class="n">train_score</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
        
        <span class="c1"># Store the results</span>
        <span class="n">experiment_2_results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;f1_mean_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="s2">&quot;f1_std_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
            <span class="s2">&quot;accuracy_mean_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="s2">&quot;accuracy_std_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
            <span class="s2">&quot;f1_mean_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="s2">&quot;f1_std_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
            <span class="s2">&quot;accuracy_mean_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="s2">&quot;accuracy_std_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
            <span class="s2">&quot;train_accuracy&quot;</span><span class="p">:</span> <span class="n">train_score</span>
        <span class="p">}</span>
        
        <span class="c1"># Log metrics to MLflow</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_F1_Mean_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_F1_Std_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_Accuracy_Mean_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_Accuracy_Std_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_F1_Mean_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_F1_Std_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_Accuracy_Mean_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_Accuracy_Std_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_Train_Accuracy&quot;</span><span class="p">,</span> <span class="n">train_score</span><span class="p">)</span>
        
        <span class="c1"># Save CV results as CSV files and log as artifacts</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cv_results_3</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_cv_results_3fold.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cv_results_10</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_cv_results_10fold.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_cv_results_3fold.csv&quot;</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_cv_results_10fold.csv&quot;</span><span class="p">)</span>
        
        <span class="c1"># Print results for the current classifier</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> Results:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3-Fold CV F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10-Fold CV F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training Accuracy: </span><span class="si">{</span><span class="n">train_score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running LogisticRegression...
LogisticRegression Results:
3-Fold CV F1-Score (Mean ± Std): 0.5966 ± 0.0242
10-Fold CV F1-Score (Mean ± Std): 0.6054 ± 0.0506
Training Accuracy: 0.7727

Running RidgeClassifier...
RidgeClassifier Results:
3-Fold CV F1-Score (Mean ± Std): 0.5769 ± 0.0449
10-Fold CV F1-Score (Mean ± Std): 0.5848 ± 0.0470
Training Accuracy: 0.7669

Running RandomForestClassifier...
RandomForestClassifier Results:
3-Fold CV F1-Score (Mean ± Std): 0.6869 ± 0.0194
10-Fold CV F1-Score (Mean ± Std): 0.6996 ± 0.0256
Training Accuracy: 0.9281

Running XGBClassifier...
XGBClassifier Results:
3-Fold CV F1-Score (Mean ± Std): 0.7040 ± 0.0335
10-Fold CV F1-Score (Mean ± Std): 0.6988 ± 0.0311
Training Accuracy: 0.9000
🏃 View run Model Comparison at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/e438b7d517214d9ebb20b7ebb6b1dd45
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Feature Engineering and Evaluation&quot;</span><span class="p">):</span>

    <span class="c1"># Create a copy of the training data</span>
    <span class="n">train_data_fe</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Step 1: Feature Engineering</span>
    <span class="c1"># Example 1: Interaction term between Age and AnnualIncome</span>
    <span class="n">train_data_fe</span><span class="p">[</span><span class="s1">&#39;Age_Income_Interaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;AnnualIncome&#39;</span><span class="p">]</span>

    <span class="c1"># Example 2: Ratio of FamilyMembers to Age</span>
    <span class="n">train_data_fe</span><span class="p">[</span><span class="s1">&#39;Family_Age_Ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;FamilyMembers&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span>

    <span class="c1"># Example 3: Log transformation of AnnualIncome to reduce skewness</span>
    <span class="n">train_data_fe</span><span class="p">[</span><span class="s1">&#39;Log_AnnualIncome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;AnnualIncome&#39;</span><span class="p">])</span>

    <span class="c1"># Add similar features to test data for consistency</span>
    <span class="n">test_data_fe</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">test_data_fe</span><span class="p">[</span><span class="s1">&#39;Age_Income_Interaction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;AnnualIncome&#39;</span><span class="p">]</span>
    <span class="n">test_data_fe</span><span class="p">[</span><span class="s1">&#39;Family_Age_Ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;FamilyMembers&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span>
    <span class="n">test_data_fe</span><span class="p">[</span><span class="s1">&#39;Log_AnnualIncome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;AnnualIncome&#39;</span><span class="p">])</span>

    <span class="c1"># Log engineered features</span>
    <span class="n">engineered_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Age_Income_Interaction&#39;</span><span class="p">,</span> <span class="s1">&#39;Family_Age_Ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;Log_AnnualIncome&#39;</span><span class="p">]</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Engineered_Features&quot;</span><span class="p">,</span> <span class="n">engineered_features</span><span class="p">)</span>

    <span class="c1"># Save datasets with engineered features</span>
    <span class="n">train_data_fe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;train_data_fe.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">test_data_fe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;test_data_fe.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;train_data_fe.csv&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;test_data_fe.csv&quot;</span><span class="p">)</span>

    <span class="c1"># Step 2: Evaluate the Impact of Engineered Features</span>
    <span class="c1"># Use the best-performing model from Experiment #2 (XGBoost)</span>
    <span class="n">pipeline_fe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">])</span>

    <span class="c1"># Perform 3-fold cross-validation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing 3-fold CV with Feature Engineering...&quot;</span><span class="p">)</span>
    <span class="n">cv_results_3_fe</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">pipeline_fe</span><span class="p">,</span> <span class="n">train_data_fe</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Perform 10-fold cross-validation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing 10-fold CV with Feature Engineering...&quot;</span><span class="p">)</span>
    <span class="n">cv_results_10_fe</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">pipeline_fe</span><span class="p">,</span> <span class="n">train_data_fe</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Train on the full training data</span>
    <span class="n">pipeline_fe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data_fe</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
    <span class="n">train_score_fe</span> <span class="o">=</span> <span class="n">pipeline_fe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">train_data_fe</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>

    <span class="c1"># Log results</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Mean_3Fold_FE&quot;</span><span class="p">,</span> <span class="n">cv_results_3_fe</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Std_3Fold_FE&quot;</span><span class="p">,</span> <span class="n">cv_results_3_fe</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Mean_3Fold_FE&quot;</span><span class="p">,</span> <span class="n">cv_results_3_fe</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Std_3Fold_FE&quot;</span><span class="p">,</span> <span class="n">cv_results_3_fe</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Mean_10Fold_FE&quot;</span><span class="p">,</span> <span class="n">cv_results_10_fe</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Std_10Fold_FE&quot;</span><span class="p">,</span> <span class="n">cv_results_10_fe</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Mean_10Fold_FE&quot;</span><span class="p">,</span> <span class="n">cv_results_10_fe</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Std_10Fold_FE&quot;</span><span class="p">,</span> <span class="n">cv_results_10_fe</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Train_Accuracy_FE&quot;</span><span class="p">,</span> <span class="n">train_score_fe</span><span class="p">)</span>

    <span class="c1"># Display results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3-Fold CV Results with Feature Engineering:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_3_fe</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_3_fe</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_3_fe</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_3_fe</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">10-Fold CV Results with Feature Engineering:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_10_fe</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_10_fe</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_10_fe</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_10_fe</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training Accuracy with Feature Engineering: </span><span class="si">{</span><span class="n">train_score_fe</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing 3-fold CV with Feature Engineering...
Performing 10-fold CV with Feature Engineering...
3-Fold CV Results with Feature Engineering:
F1-Score (Mean ± Std): 0.7040 ± 0.0335
Accuracy (Mean ± Std): 0.8072 ± 0.0130

10-Fold CV Results with Feature Engineering:
F1-Score (Mean ± Std): 0.6988 ± 0.0311
Accuracy (Mean ± Std): 0.8079 ± 0.0144

Training Accuracy with Feature Engineering: 0.9000
🏃 View run Feature Engineering and Evaluation at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/bcacfb39ab0d43978e05122f69e9be21
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Function to Remove Highly Correlated Features</span>
<span class="k">def</span> <span class="nf">remove_high_correlation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove features with a high correlation above the given threshold.&quot;&quot;&quot;</span>
    <span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="s1">&#39;int64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>  <span class="c1"># Use only numerical data for correlation</span>
    <span class="n">upper_triangle</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>
    <span class="n">high_corr_features</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">upper_triangle</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">upper_triangle</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">high_corr_features</span><span class="p">),</span> <span class="n">high_corr_features</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Feature Selection and Evaluation&quot;</span><span class="p">):</span>

    <span class="c1"># Step 1: Correlation Threshold</span>
    <span class="n">train_data_corr</span><span class="p">,</span> <span class="n">removed_corr_features</span> <span class="o">=</span> <span class="n">remove_high_correlation</span><span class="p">(</span><span class="n">train_data_fe</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed Features due to High Correlation: </span><span class="si">{</span><span class="n">removed_corr_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Removed_High_Correlation_Features&quot;</span><span class="p">,</span> <span class="n">removed_corr_features</span><span class="p">)</span>

    <span class="c1"># Step 2: Preprocessing for Feature Importance</span>
    <span class="n">train_data_encoded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">train_data_corr</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">test_data_encoded</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">test_data_fe</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Align train and test sets</span>
    <span class="n">test_data_encoded</span> <span class="o">=</span> <span class="n">test_data_encoded</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">train_data_encoded</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Step 3: Feature Importance</span>
    <span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">rf_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data_encoded</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
    <span class="n">feature_importances</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Feature&#39;</span><span class="p">:</span> <span class="n">train_data_encoded</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
        <span class="s1">&#39;Importance&#39;</span><span class="p">:</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">feature_importances_</span>
    <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Importance&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Top Features Based on Importance:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">feature_importances</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Log feature importance as an artifact</span>
    <span class="n">feature_importances</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;feature_importances.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;feature_importances.csv&quot;</span><span class="p">)</span>

    <span class="c1"># Log top 10 features</span>
    <span class="n">top_features</span> <span class="o">=</span> <span class="n">feature_importances</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Top_Features&quot;</span><span class="p">,</span> <span class="n">top_features</span><span class="p">)</span>

    <span class="c1"># Step 4: Variance Threshold</span>
    <span class="n">var_thresh</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">train_data_var</span> <span class="o">=</span> <span class="n">var_thresh</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_data_encoded</span><span class="p">[</span><span class="n">top_features</span><span class="p">])</span>
    <span class="n">test_data_var</span> <span class="o">=</span> <span class="n">var_thresh</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_data_encoded</span><span class="p">[</span><span class="n">top_features</span><span class="p">])</span>
    <span class="n">retained_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">top_features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">var_thresh</span><span class="o">.</span><span class="n">get_support</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retained Features After Variance Threshold: </span><span class="si">{</span><span class="n">retained_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Retained_Features_After_Variance_Threshold&quot;</span><span class="p">,</span> <span class="n">retained_features</span><span class="p">)</span>

    <span class="c1"># Step 5: Evaluate the Impact of Feature Selection</span>
    <span class="n">pipeline_fs</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">])</span>

    <span class="c1"># Perform 3-fold cross-validation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing 3-fold CV with Feature Selection...&quot;</span><span class="p">)</span>
    <span class="n">cv_results_3_fs</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">pipeline_fs</span><span class="p">,</span> <span class="n">train_data_var</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Perform 10-fold cross-validation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing 10-fold CV with Feature Selection...&quot;</span><span class="p">)</span>
    <span class="n">cv_results_10_fs</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">pipeline_fs</span><span class="p">,</span> <span class="n">train_data_var</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Train on the full training data</span>
    <span class="n">pipeline_fs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data_var</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
    <span class="n">train_score_fs</span> <span class="o">=</span> <span class="n">pipeline_fs</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">train_data_var</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>

    <span class="c1"># Log results</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Mean_3Fold_FS&quot;</span><span class="p">,</span> <span class="n">cv_results_3_fs</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Std_3Fold_FS&quot;</span><span class="p">,</span> <span class="n">cv_results_3_fs</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Mean_3Fold_FS&quot;</span><span class="p">,</span> <span class="n">cv_results_3_fs</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Std_3Fold_FS&quot;</span><span class="p">,</span> <span class="n">cv_results_3_fs</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Mean_10Fold_FS&quot;</span><span class="p">,</span> <span class="n">cv_results_10_fs</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Std_10Fold_FS&quot;</span><span class="p">,</span> <span class="n">cv_results_10_fs</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Mean_10Fold_FS&quot;</span><span class="p">,</span> <span class="n">cv_results_10_fs</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Std_10Fold_FS&quot;</span><span class="p">,</span> <span class="n">cv_results_10_fs</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Train_Accuracy_FS&quot;</span><span class="p">,</span> <span class="n">train_score_fs</span><span class="p">)</span>

    <span class="c1"># Display results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3-Fold CV Results with Feature Selection:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_3_fs</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_3_fs</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_3_fs</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_3_fs</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">10-Fold CV Results with Feature Selection:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_10_fs</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_10_fs</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_10_fs</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_10_fs</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training Accuracy with Feature Selection: </span><span class="si">{</span><span class="n">train_score_fs</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Removed Features due to High Correlation: [&#39;Age_Income_Interaction&#39;, &#39;Family_Age_Ratio&#39;, &#39;Log_AnnualIncome&#39;]
Top Features Based on Importance:
                                        Feature  Importance
1                                  AnnualIncome    0.430019
2                                 FamilyMembers    0.184234
0                                           Age    0.181640
7                      Travel_Abroad_Status_Yes    0.093781
3                               ChronicDiseases    0.036929
6                     Frequent_Flyer_Status_Yes    0.034706
4  Employment_Type_Private Sector/Self Employed    0.022942
5                           Graduate_Status_Yes    0.015748
Retained Features After Variance Threshold: [&#39;AnnualIncome&#39;, &#39;FamilyMembers&#39;, &#39;Age&#39;, &#39;Travel_Abroad_Status_Yes&#39;, &#39;ChronicDiseases&#39;, &#39;Frequent_Flyer_Status_Yes&#39;, &#39;Employment_Type_Private Sector/Self Employed&#39;, &#39;Graduate_Status_Yes&#39;]
Performing 3-fold CV with Feature Selection...
Performing 10-fold CV with Feature Selection...
3-Fold CV Results with Feature Selection:
F1-Score (Mean ± Std): 0.7040 ± 0.0335
Accuracy (Mean ± Std): 0.8072 ± 0.0130

10-Fold CV Results with Feature Selection:
F1-Score (Mean ± Std): 0.7003 ± 0.0321
Accuracy (Mean ± Std): 0.8086 ± 0.0158

Training Accuracy with Feature Selection: 0.9000
🏃 View run Feature Selection and Evaluation at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/5c25c66dcffb4ece8fcc042d0c413453
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;PCA and Model Evaluation&quot;</span><span class="p">):</span>

    <span class="c1"># Step 1: Standardize Numerical Features</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">train_data_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_data_var</span><span class="p">)</span>
    <span class="n">test_data_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_data_var</span><span class="p">)</span>

    <span class="c1"># Step 2: Apply PCA</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
    <span class="n">train_data_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_data_scaled</span><span class="p">)</span>

    <span class="c1"># Step 3: Scree Plot</span>
    <span class="n">explained_variance</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
    <span class="n">cumulative_variance</span> <span class="o">=</span> <span class="n">explained_variance</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cumulative_variance</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scree Plot - Cumulative Explained Variance&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of Principal Components&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Explained Variance&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;scree_plot.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;scree_plot.png&quot;</span><span class="p">)</span>

    <span class="c1"># Select the number of components to retain 95% variance</span>
    <span class="n">num_components</span> <span class="o">=</span> <span class="p">(</span><span class="n">cumulative_variance</span> <span class="o">&gt;=</span> <span class="mf">0.95</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Components to Retain 95% Variance: </span><span class="si">{</span><span class="n">num_components</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Num_Components_95_Variance&quot;</span><span class="p">,</span> <span class="n">num_components</span><span class="p">)</span>

    <span class="c1"># Step 4: Reduce Data to Selected Components</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">num_components</span><span class="p">)</span>
    <span class="n">train_data_reduced</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_data_scaled</span><span class="p">)</span>
    <span class="n">test_data_reduced</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_data_scaled</span><span class="p">)</span>

    <span class="c1"># Step 5: Evaluate Model with Reduced Features</span>
    <span class="n">pipeline_pca</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">])</span>

    <span class="c1"># Perform 3-fold cross-validation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing 3-fold CV with PCA...&quot;</span><span class="p">)</span>
    <span class="n">cv_results_3_pca</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">pipeline_pca</span><span class="p">,</span> <span class="n">train_data_reduced</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Perform 10-fold cross-validation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing 10-fold CV with PCA...&quot;</span><span class="p">)</span>
    <span class="n">cv_results_10_pca</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">pipeline_pca</span><span class="p">,</span> <span class="n">train_data_reduced</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Train on the full training data</span>
    <span class="n">pipeline_pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data_reduced</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
    <span class="n">train_score_pca</span> <span class="o">=</span> <span class="n">pipeline_pca</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">train_data_reduced</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>

    <span class="c1"># Log cross-validation and training results</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Mean_3Fold_PCA&quot;</span><span class="p">,</span> <span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Std_3Fold_PCA&quot;</span><span class="p">,</span> <span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Mean_3Fold_PCA&quot;</span><span class="p">,</span> <span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Std_3Fold_PCA&quot;</span><span class="p">,</span> <span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Mean_10Fold_PCA&quot;</span><span class="p">,</span> <span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Std_10Fold_PCA&quot;</span><span class="p">,</span> <span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Mean_10Fold_PCA&quot;</span><span class="p">,</span> <span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Std_10Fold_PCA&quot;</span><span class="p">,</span> <span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Train_Accuracy_PCA&quot;</span><span class="p">,</span> <span class="n">train_score_pca</span><span class="p">)</span>

    <span class="c1"># Store results</span>
    <span class="n">experiment_5_results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;f1_mean_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;f1_std_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_mean_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_std_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;f1_mean_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;f1_std_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_mean_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_std_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;train_accuracy&quot;</span><span class="p">:</span> <span class="n">train_score_pca</span>
    <span class="p">}</span>

    <span class="c1"># Display results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3-Fold CV Results with PCA:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_3_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">10-Fold CV Results with PCA:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_10_pca</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training Accuracy with PCA: </span><span class="si">{</span><span class="n">train_score_pca</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6817e57d5dc94f04246a41750c08ff6b743cc6622c21ab4f477b35e300735cd8.png" src="../_images/6817e57d5dc94f04246a41750c08ff6b743cc6622c21ab4f477b35e300735cd8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of Components to Retain 95% Variance: 8
Performing 3-fold CV with PCA...
Performing 10-fold CV with PCA...
3-Fold CV Results with PCA:
F1-Score (Mean ± Std): 0.6782 ± 0.0305
Accuracy (Mean ± Std): 0.7820 ± 0.0150

10-Fold CV Results with PCA:
F1-Score (Mean ± Std): 0.6809 ± 0.0277
Accuracy (Mean ± Std): 0.7899 ± 0.0170

Training Accuracy with PCA: 0.9281
🏃 View run PCA and Model Evaluation at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/ee0d86d930124370862c47398f3eae79
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span><span class="p">,</span> <span class="n">cross_validate</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">randint</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">import</span> <span class="nn">mlflow</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;XGBoost Hyperparameter Tuning&quot;</span><span class="p">):</span>

    <span class="c1"># Step 1: Combine Feature Selection and PCA</span>
    <span class="c1"># Use the retained features from Experiment #4</span>
    <span class="n">selected_features</span> <span class="o">=</span> <span class="n">retained_features</span>  <span class="c1"># From Experiment #4</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">train_data_combined</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_data_encoded</span><span class="p">[</span><span class="n">selected_features</span><span class="p">])</span>
    <span class="n">test_data_combined</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_data_encoded</span><span class="p">[</span><span class="n">selected_features</span><span class="p">])</span>

    <span class="c1"># Apply PCA on the selected features</span>
    <span class="n">pca_combined</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># Retain 95% variance as per Experiment #5</span>
    <span class="n">train_data_combined_pca</span> <span class="o">=</span> <span class="n">pca_combined</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_data_combined</span><span class="p">)</span>
    <span class="n">test_data_combined_pca</span> <span class="o">=</span> <span class="n">pca_combined</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_data_combined</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Selected_Features&quot;</span><span class="p">,</span> <span class="n">selected_features</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;PCA_Components&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

    <span class="c1"># Step 2: Define XGBoost Hyperparameter Space</span>
    <span class="n">param_distributions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="n">randint</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
        <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">),</span>
        <span class="s1">&#39;colsample_bytree&#39;</span><span class="p">:</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1"># Initialize XGBoost model without use_label_encoder</span>
    <span class="n">xgb_model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="c1"># Step 3: Hyperparameter Tuning with RandomizedSearchCV</span>
    <span class="n">random_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span>
        <span class="n">estimator</span><span class="o">=</span><span class="n">xgb_model</span><span class="p">,</span>
        <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_distributions</span><span class="p">,</span>
        <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Number of configurations to try</span>
        <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># 3-fold CV</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tuning hyperparameters with RandomizedSearchCV...&quot;</span><span class="p">)</span>
    <span class="n">random_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data_combined_pca</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>

    <span class="c1"># Best hyperparameters</span>
    <span class="n">best_params</span> <span class="o">=</span> <span class="n">random_search</span><span class="o">.</span><span class="n">best_params_</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best Hyperparameters:&quot;</span><span class="p">,</span> <span class="n">best_params</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Best_Hyperparameters&quot;</span><span class="p">,</span> <span class="n">best_params</span><span class="p">)</span>

    <span class="c1"># Step 4: Evaluate the Optimized Model</span>
    <span class="n">best_xgb</span> <span class="o">=</span> <span class="n">random_search</span><span class="o">.</span><span class="n">best_estimator_</span>

    <span class="c1"># Perform 3-fold cross-validation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing 3-fold CV with Optimized XGBoost...&quot;</span><span class="p">)</span>
    <span class="n">cv_results_3_custom</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">best_xgb</span><span class="p">,</span> <span class="n">train_data_combined_pca</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Perform 10-fold cross-validation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performing 10-fold CV with Optimized XGBoost...&quot;</span><span class="p">)</span>
    <span class="n">cv_results_10_custom</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">best_xgb</span><span class="p">,</span> <span class="n">train_data_combined_pca</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Train on the full training data</span>
    <span class="n">best_xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data_combined_pca</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
    <span class="n">train_score_custom</span> <span class="o">=</span> <span class="n">best_xgb</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">train_data_combined_pca</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>

    <span class="c1"># Log cross-validation and training results</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Mean_3Fold_Optimized&quot;</span><span class="p">,</span> <span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Std_3Fold_Optimized&quot;</span><span class="p">,</span> <span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Mean_3Fold_Optimized&quot;</span><span class="p">,</span> <span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Std_3Fold_Optimized&quot;</span><span class="p">,</span> <span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Mean_10Fold_Optimized&quot;</span><span class="p">,</span> <span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1_Std_10Fold_Optimized&quot;</span><span class="p">,</span> <span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Mean_10Fold_Optimized&quot;</span><span class="p">,</span> <span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy_Std_10Fold_Optimized&quot;</span><span class="p">,</span> <span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Train_Accuracy_Optimized&quot;</span><span class="p">,</span> <span class="n">train_score_custom</span><span class="p">)</span>

    <span class="c1"># Store results</span>
    <span class="n">experiment_6_results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;f1_mean_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;f1_std_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_mean_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_std_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;f1_mean_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;f1_std_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_mean_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;accuracy_std_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;train_accuracy&quot;</span><span class="p">:</span> <span class="n">train_score_custom</span><span class="p">,</span>
        <span class="s2">&quot;best_params&quot;</span><span class="p">:</span> <span class="n">best_params</span>
    <span class="p">}</span>

    <span class="c1"># Display results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3-Fold CV Results with Optimized XGBoost:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_3_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">10-Fold CV Results with Optimized XGBoost:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-Score (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy (Mean ± Std): </span><span class="si">{</span><span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">cv_results_10_custom</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training Accuracy with Optimized XGBoost: </span><span class="si">{</span><span class="n">train_score_custom</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tuning hyperparameters with RandomizedSearchCV...
Best Hyperparameters: {&#39;colsample_bytree&#39;: 0.8090931317527976, &#39;learning_rate&#39;: 0.09550820367170992, &#39;max_depth&#39;: 4, &#39;n_estimators&#39;: 173, &#39;subsample&#39;: 0.6431565707973218}
Performing 3-fold CV with Optimized XGBoost...
Performing 10-fold CV with Optimized XGBoost...
3-Fold CV Results with Optimized XGBoost:
F1-Score (Mean ± Std): 0.6969 ± 0.0279
Accuracy (Mean ± Std): 0.8058 ± 0.0096

10-Fold CV Results with Optimized XGBoost:
F1-Score (Mean ± Std): 0.6921 ± 0.0348
Accuracy (Mean ± Std): 0.8058 ± 0.0137

Training Accuracy with Optimized XGBoost: 0.8957
🏃 View run XGBoost Hyperparameter Tuning at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/5920275ec0cc44348fce4b4ed5287cb5
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;SMOTE and Model Comparison&quot;</span><span class="p">):</span>

    <span class="c1"># Step 1: Apply SMOTE to Balance the Dataset</span>
    <span class="n">smote</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">train_data_balanced</span><span class="p">,</span> <span class="n">train_labels_balanced</span> <span class="o">=</span> <span class="n">smote</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">train_data_combined_pca</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>

    <span class="n">original_class_distribution</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">balanced_class_distribution</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">train_labels_balanced</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original Class Distribution: </span><span class="si">{</span><span class="n">original_class_distribution</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Balanced Class Distribution: </span><span class="si">{</span><span class="n">balanced_class_distribution</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Log class distributions</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Original_Class_Distribution&quot;</span><span class="p">,</span> <span class="n">original_class_distribution</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Balanced_Class_Distribution&quot;</span><span class="p">,</span> <span class="n">balanced_class_distribution</span><span class="p">)</span>

    <span class="c1"># Step 2: Define Models for Comparison</span>
    <span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;XGBoost&#39;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="o">**</span><span class="n">best_params</span><span class="p">),</span>
        <span class="s1">&#39;RandomForest&#39;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
        <span class="s1">&#39;LogisticRegression&#39;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1"># Step 3: Evaluate Each Model</span>
    <span class="n">experiment_7_results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluating </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Perform 3-fold cross-validation</span>
        <span class="n">cv_results_3</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span> <span class="n">train_data_balanced</span><span class="p">,</span> <span class="n">train_labels_balanced</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        
        <span class="c1"># Perform 10-fold cross-validation</span>
        <span class="n">cv_results_10</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span> <span class="n">train_data_balanced</span><span class="p">,</span> <span class="n">train_labels_balanced</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        
        <span class="c1"># Train the model on the full training data</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data_balanced</span><span class="p">,</span> <span class="n">train_labels_balanced</span><span class="p">)</span>
        <span class="n">train_accuracy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">train_data_balanced</span><span class="p">,</span> <span class="n">train_labels_balanced</span><span class="p">)</span>
        
        <span class="c1"># Store results</span>
        <span class="n">experiment_7_results</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;f1_mean_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="s2">&quot;f1_std_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
            <span class="s2">&quot;accuracy_mean_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="s2">&quot;accuracy_std_3fold&quot;</span><span class="p">:</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
            <span class="s2">&quot;f1_mean_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="s2">&quot;f1_std_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
            <span class="s2">&quot;accuracy_mean_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="s2">&quot;accuracy_std_10fold&quot;</span><span class="p">:</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
            <span class="s2">&quot;train_accuracy&quot;</span><span class="p">:</span> <span class="n">train_accuracy</span>
        <span class="p">}</span>

        <span class="c1"># Log metrics for each model</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_F1_Mean_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_F1_Std_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_Accuracy_Mean_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_Accuracy_Std_3Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_3</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_F1_Mean_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_F1_Std_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_Accuracy_Mean_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_Accuracy_Std_10Fold&quot;</span><span class="p">,</span> <span class="n">cv_results_10</span><span class="p">[</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_Train_Accuracy&quot;</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">)</span>

    <span class="c1"># Step 4: Display Results</span>
    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">experiment_7_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Results for </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3-Fold CV F1-Score: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;f1_mean_3fold&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;f1_std_3fold&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3-Fold CV Accuracy: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;accuracy_mean_3fold&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;accuracy_std_3fold&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10-Fold CV F1-Score: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;f1_mean_10fold&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;f1_std_10fold&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10-Fold CV Accuracy: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;accuracy_mean_10fold&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;accuracy_std_10fold&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training Accuracy: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;train_accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Original Class Distribution: {0: 893, 1: 497}
Balanced Class Distribution: {0: 893, 1: 893}
Evaluating XGBoost...
Evaluating RandomForest...
Evaluating LogisticRegression...

Results for XGBoost:
3-Fold CV F1-Score: 0.7577 ± 0.0167
3-Fold CV Accuracy: 0.7716 ± 0.0130
10-Fold CV F1-Score: 0.7672 ± 0.0349
10-Fold CV Accuracy: 0.7834 ± 0.0272
Training Accuracy: 0.9003

Results for RandomForest:
3-Fold CV F1-Score: 0.7566 ± 0.0102
3-Fold CV Accuracy: 0.7844 ± 0.0098
10-Fold CV F1-Score: 0.7655 ± 0.0236
10-Fold CV Accuracy: 0.7923 ± 0.0151
Training Accuracy: 0.8830

Results for LogisticRegression:
3-Fold CV F1-Score: 0.6895 ± 0.0105
3-Fold CV Accuracy: 0.7172 ± 0.0063
10-Fold CV F1-Score: 0.6879 ± 0.0384
10-Fold CV Accuracy: 0.7161 ± 0.0308
Training Accuracy: 0.7223
🏃 View run SMOTE and Model Comparison at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/89b54541c1c14499899771ebb78928b7
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">sanitize_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="c1"># Replace special characters with underscores and limit length</span>
    <span class="n">sanitized</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^A-Za-z0-9_]&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sanitized</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>  <span class="c1"># Limit the name to 50 characters</span>

<span class="c1"># Start an MLflow run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;F1-Score Comparison&quot;</span><span class="p">):</span>

    <span class="c1"># Collect F1-score results from the experiments</span>
    <span class="n">experiment_results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Experiment #4 (Feature Selection)&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;3-Fold&#39;</span><span class="p">:</span> <span class="mf">0.7040</span><span class="p">,</span>
            <span class="s1">&#39;10-Fold&#39;</span><span class="p">:</span> <span class="mf">0.7003</span>
        <span class="p">},</span>
        <span class="s1">&#39;Experiment #5 (PCA)&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;3-Fold&#39;</span><span class="p">:</span> <span class="mf">0.6782</span><span class="p">,</span>
            <span class="s1">&#39;10-Fold&#39;</span><span class="p">:</span> <span class="mf">0.6809</span>
        <span class="p">},</span>
        <span class="s1">&#39;Experiment #6 (Optimized XGBoost)&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;3-Fold&#39;</span><span class="p">:</span> <span class="mf">0.6969</span><span class="p">,</span>
            <span class="s1">&#39;10-Fold&#39;</span><span class="p">:</span> <span class="mf">0.6921</span>
        <span class="p">},</span>
        <span class="s1">&#39;Experiment #7 (SMOTE &amp; XGBoost)&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;3-Fold&#39;</span><span class="p">:</span> <span class="mf">0.7577</span><span class="p">,</span>
            <span class="s1">&#39;10-Fold&#39;</span><span class="p">:</span> <span class="mf">0.7672</span>
        <span class="p">},</span>
        <span class="s1">&#39;Experiment #7 (SMOTE &amp; RandomForest)&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;3-Fold&#39;</span><span class="p">:</span> <span class="mf">0.7566</span><span class="p">,</span>
            <span class="s1">&#39;10-Fold&#39;</span><span class="p">:</span> <span class="mf">0.7655</span>
        <span class="p">},</span>
        <span class="s1">&#39;Experiment #7 (SMOTE &amp; LogisticRegression)&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;3-Fold&#39;</span><span class="p">:</span> <span class="mf">0.6895</span><span class="p">,</span>
            <span class="s1">&#39;10-Fold&#39;</span><span class="p">:</span> <span class="mf">0.6879</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># Extract experiment names and F1-scores</span>
    <span class="n">experiment_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">experiment_results</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">f1_scores_3_fold</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;3-Fold&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">experiment_results</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
    <span class="n">f1_scores_10_fold</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;10-Fold&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">experiment_results</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

    <span class="c1"># Log F1-scores to MLflow as metrics</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">experiment_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">sanitized_name</span> <span class="o">=</span> <span class="n">sanitize_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sanitized_name</span><span class="si">}</span><span class="s2">_3Fold_F1&quot;</span><span class="p">,</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;3-Fold&#39;</span><span class="p">])</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sanitized_name</span><span class="si">}</span><span class="s2">_10Fold_F1&quot;</span><span class="p">,</span> <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;10-Fold&#39;</span><span class="p">])</span>

    <span class="c1"># Create a bar chart for F1-score comparison</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">experiment_names</span><span class="p">))</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.35</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">f1_scores_3_fold</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;3-Fold CV&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">f1_scores_10_fold</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;10-Fold CV&#39;</span><span class="p">)</span>

    <span class="c1"># Add labels and title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Experiments&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;F1-Score&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;F1-Score Comparison Across Experiments&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">experiment_names</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># Save the plot and log it as an artifact</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;f1_score_comparison.png&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;f1_score_comparison.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dbdafc0866d7e23353d221838007fe0a2c92e1b4348f574f80d00b18b1ebcb95.png" src="../_images/dbdafc0866d7e23353d221838007fe0a2c92e1b4348f574f80d00b18b1ebcb95.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>🏃 View run F1-Score Comparison at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0/runs/0a9dfe285b114f56814cd4a667726047
🧪 View experiment at: https://dagshub.com/mahiswarreddydesireddy18/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Directory to save the model</span>
<span class="n">model_dir</span> <span class="o">=</span> <span class="s2">&quot;saved_models_after_dags&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Path to save the model</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;xgboost_smote_model.joblib&quot;</span><span class="p">)</span>

<span class="c1"># Save the trained XGBoost model</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best_xgb</span><span class="p">,</span> <span class="n">model_path</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model saved successfully at </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model saved successfully at saved_models_after_dags\xgboost_smote_model.joblib
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Load the saved model</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;saved_models_after_dags/xgboost_smote_model.joblib&quot;</span>  <span class="c1"># Adjust path if necessary</span>
<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model loaded successfully from </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Example test data (replace this with actual data for predictions)</span>
<span class="c1"># Input data should match the features and preprocessing used during training</span>
<span class="n">test_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Make a prediction</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_sample</span><span class="p">)</span>
<span class="n">probability</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_sample</span><span class="p">)</span>

<span class="c1"># Interpret prediction</span>
<span class="k">if</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction: Likely to purchase travel insurance&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction: Unlikely to purchase travel insurance&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Probability: </span><span class="si">{</span><span class="n">probability</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model loaded successfully from saved_models_after_dags/xgboost_smote_model.joblib
Prediction: Likely to purchase travel insurance
Probability: [[0.21571302 0.784287  ]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Directory to save the model</span>
<span class="n">model_dir</span> <span class="o">=</span> <span class="s2">&quot;saved_models_after_dags&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Path to save the model</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;xgboost_smote_model.pkl&quot;</span><span class="p">)</span>

<span class="c1"># Save the trained XGBoost model</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best_xgb</span><span class="p">,</span> <span class="n">model_path</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model saved successfully at </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model saved successfully at saved_models_after_dags\xgboost_smote_model.pkl
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Load the saved model</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;saved_models_after_dags/xgboost_smote_model.pkl&quot;</span>  <span class="c1"># Adjust path if necessary</span>
<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model loaded successfully from </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Example test data (replace this with actual data for predictions)</span>
<span class="c1"># Input data should match the features and preprocessing used during training</span>
<span class="n">test_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">600000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Make a prediction</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_sample</span><span class="p">)</span>
<span class="n">probability</span> <span class="o">=</span> <span class="n">loaded_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_sample</span><span class="p">)</span>

<span class="c1"># Interpret prediction</span>
<span class="k">if</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction: Likely to purchase travel insurance&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction: Unlikely to purchase travel insurance&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Probability: </span><span class="si">{</span><span class="n">probability</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model loaded successfully from saved_models_after_dags/xgboost_smote_model.pkl
Prediction: Unlikely to purchase travel insurance
Probability: [[0.8906608  0.10933919]]
</pre></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="simple visible nav section-nav flex-column">
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mahiswar Reddy Desireddy
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>